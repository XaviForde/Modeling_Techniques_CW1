
\documentclass[11pt]{article}

%\setlength\topmargin{-0.1in}
%\setlength\headheight{0in}
%\setlength\headsep{0in}
\setlength\textheight{8.5in}
\setlength\textwidth{6.5in}
\setlength\oddsidemargin{0in}
\setlength\evensidemargin{0in}
\setlength{\parindent}{0pt}
\usepackage{placeins}
%\usepackage{indentfirst}

\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{listings}
\usepackage{rotating}
\usepackage{subcaption} 
\usepackage{booktabs}
\usepackage{tikz}
\usepackage{fancyhdr}
\usepackage{pdfpages}
\usepackage{hyperref}
\usepackage{longtable}
\usepackage[toc,page]{appendix}
%For The 2x2 Figure
\usepackage{subcaption}
\usepackage{mwe}
% To import matlab code
\usepackage{listings}
\usepackage{matlab-prettifier}
\usepackage[framed,numbered,autolinebreaks,useliterate]{mcode}
%Glossary
\usepackage[acronym,nonumberlist]{glossaries}
%\glsaddall %includes all acronymns
%Tables
\usepackage{booktabs}
\newcommand{\ra}[1]{\renewcommand{\arraystretch}{#1}}
%Nomenclature
\usepackage{nomencl}
\makenomenclature
\newif\iffirstglossary\firstglossarytrue
%% This removes the main title:
\renewcommand{\nomname}{}
%% this modifies item separation:
\setlength{\nomitemsep}{15pt}
%% this part defines the groups:
%----------------------------------------------
\usepackage{etoolbox}
\renewcommand\nomgroup[1]{%
  \item[\Large\bfseries
  \ifstrequal{#1}{N}{Nomenclature}{%
  \ifstrequal{#1}{A}{List of Abbreviations}{}}%
]\vspace{10pt}} % this is to add vertical space between the groups.
%----------------------------------------------



\pagestyle{fancy}
\usetikzlibrary{shapes,arrows}
\graphicspath{{Figures/}}
\newcommand{\tabitem}{~~\llap{\textbullet}~~}

\newcommand*{\MyIndent}{\hspace*{0.5cm}}%inerts tab in tables



 
\begin{document} 
\pagenumbering{gobble}

	\begin{titlepage}
	\thispagestyle{empty}
		\newcommand{\HRule}{\rule{\linewidth}{0.5mm}}	
		\center
		\LARGE 
		University of Bath\\
	 	Faculty of Engineering \& Design\\[1cm]	
		%textbf{\Large ME30313 Group Business & Design}\\
		\large
		Word count: XXXXX\\[0.5cm]
		{\large\today}\\[1cm]	
		\HRule\\[0.4cm]	
		{\huge\bfseries Systems Modelling \& Simulation Coursework 1}\\[0.4cm] 	
		\HRule\\[1cm]	
		\begin{minipage}{0.4\textwidth}
			\begin{flushleft}
				\large
				\textit{Supervisor}\\
				A. \textsc{Cookson}
			\end{flushleft}
		\end{minipage}
		~
		\begin{minipage}{0.4\textwidth}
			\begin{flushright}
				\large
				\textit{Assessor}\\
				A. \textsc{Cookson} 
			\end{flushright}
		\end{minipage}\\[1.4cm]
		\large
		\textit{Author}\\
		Xavier \textsc{Forde}\\
		\vfill
		\includegraphics[width=0.4\textwidth]{UOB_Logo.png}\\
		\vfill 
	\end{titlepage}

%%% ACRONYMS %%

%%END OF ACRONYMS %%%


\thispagestyle{empty}




\tableofcontents
\thispagestyle{empty}
\listoffigures


\nomenclature[A]{CAD}{Computer Aided Design}


%\printnomenclature


\clearpage
\pagenumbering{arabic}
%\setcounter{page}{1}
\section{Part 1: Software Verification \& Analytical Testing}

\subsection{Quation 1a}
\subsubsection{Derivation of Diffusion Element Matrix}

Here we will derive the 2-by-2 element matrix for a diffusion operator for an arbitrary element $e_{n}$ between the points $x_{0}$ $x_{1}$. The derivation will start from the weak form version of the diffusion integral, after performing integration by parts. This is given by equation \ref{eq:weakform} in the domain $x = 0$ to $x = 1$.

\begin{equation} \label{eq:weakform}
\int_0^1 D \frac{\partial c}{\partial x}  \frac{\partial v}{\partial x}  dx = \int_0^1 vf dx + \left[vD\frac{\partial c}{\partial x} \right]_0^1
\end{equation}

We have the domain from $x = 0$ to $ x = 1$ which we can split into $ne$ number of elements. This is shown pictorially by Figure \ref{fig:domain2elements} for the case $ne = 4$.

%Figure to show elements on a line
\begin{figure}[h!]
\centering
\includegraphics[width=0.75\textwidth]{SplitIntoElements.PNG}
\caption{Splitting Domain Into Equispaced Elements}\label{fig:domain2elements}
\end{figure}

We can now say the integral from $x = 0$ to $x = 1$ is equivalent to the sum of the integral of the individual elements, for the $ne = 4$ case:


%Splitting Intergral into elements
\begin{equation}
\int_0^1 dx = \int_0^\frac{1}{4}  dx + \int_\frac{1}{4}^\frac{2}{4}  dx + \int_\frac{2}{4}^\frac{3}{4}  dx + \int_\frac{3}{4}^1  dx
\end{equation}

To integrate an individual element we will use linear Lagrange nodal basis function \ref{eq:Lagrange} to represent $c$ and $x$, the functions are shown below. The test function $v$ is set to be equal to the basis function $\psi$.

\begin{subequations}
\label{eq:Lagrange}
\begin{align}
c &= c_{0}\psi_{0}(\zeta) + c_1\psi_{1}(\zeta) \label{eq:LagrangeC} \\
x &= x_{0}\psi_{0}(\zeta) + x_1\psi_{1}(\zeta) \label{eq:LagrangeX} \\
v & = \psi_{0} , \psi_{1} \label{eq:LagrangeV} \\
\text{where,}\\
\psi_{0} &= \frac{1 - \zeta}{2} \ \ \ \ ,  \ \ \ \ \psi_{1} = \frac{1 + \zeta}{2} \label{eq:LagrangePSI}\\
\text{and,}\\
\zeta  & = 2 \left(\frac{x - x_0}{x_1 - x_0}\right) - 1 \label{eq:LagrangeZeta}
\end{align}
\end{subequations}
for $x$ in that element between $x_0$ and $x_1$.\\
We need to map the local element to a standard element as shown below. The Jacobian transform $J$ is used to map from the $x$ to the $\zeta$ coordinate system as shown in Figure \ref{fig:local2standard}.


%Local element to standard element
\begin{equation} \label{eq:Jacobian}
J = \left \vert \frac{dx}{d\zeta}\right \vert
\end{equation}



%Figure to show elements mapping to standard
\begin{figure}[h!]
\centering
\includegraphics[width=0.75\textwidth]{Local2Standard.PNG}
\caption{Mapping to Standard Element}\label{fig:local2standard}
\end{figure}

Starting with the left hand side of equation \ref{eq:weakform} transforming with the Jacobian to a standard using $dx = Jd\zeta$ we get:

\begin{equation} \label{eq:LHStransform}
\int_{x_0}^{x_{1}} D \frac{\partial c}{\partial x}  \frac{\partial v}{\partial x}  dx =  \int_{-1}^{1} D \frac{\partial c}{\partial x}  \frac{\partial v}{\partial x} J d\zeta
\end{equation}

We need to evaluate the derivatives $\frac{\partial c}{\partial x}$ and $ \frac{\partial v}{\partial x}$ which we can obtain by applying the chain rule to the definitions of c and v given by equations {eq:LagrangeC} and {eq:LagrangeV}. This gives the results

\begin{subequations}
\label{eq:LagrangeD}
\begin{align}
\frac{dc}{dx} &= c_{0}\frac{d\psi_{0}}{d\zeta}\frac{d\zeta}{dx} + c_1\frac{d\psi_{1}}{d\zeta}\frac{d\zeta}{dx} = c_n\frac{d\psi_{n}}{d\zeta}\frac{d\zeta}{dx} \label{eq:LagrangeDC} \ \ \ \text{for} \ n =0,1\\
\frac{dv}{dx} &= \frac{d\psi_{m}}{d\zeta}\frac{d\zeta}{dx} \ \ \ \text{for} \ m =0,1 \label{eq:LagrangeDV} 
\end{align}
\end{subequations}

We can now rewrite equation \ref{eq:LHStransform} as the following, recognising $c$ is independent of $x$ and therefore $\zeta$.
\begin{equation} \label{eq:LHStransform}
 c_n\int_{-1}^{1} D \frac{d\psi_{n}}{d\zeta}\frac{d\zeta}{dx} \frac{d\psi_{m}}{d\zeta}\frac{d\zeta}{dx} J d\zeta
\end{equation}

Knowing that $\frac{d\zeta}{dx} = J^{-1}$ (for $x_1 > x_0$) from equation \ref{eq:Jacobian} and that for a given element $J$ is constant, we can rewrite equation \ref{eq:LHStransform} as

\begin{equation} \label{eq:LHStransform2}
 c_nJ^{-1}\int_{-1}^{1} D \frac{d\psi_{n}}{d\zeta}\frac{d\psi_{m}}{d\zeta} d\zeta \ \ \ \ \text{for} n= 0,1 \& m = 0,1
\end{equation}


From \ref{eq:LHStransform2} we have two equations, one for each node, which when written in full, is clearly suitable for matrix representation.

\begin{subequations}
\label{eq:matrixform}
\begin{align}
&J^{-1} \left  [c_0 \int_{-1}^{1} D \frac{d\psi_{0}}{d\zeta} \frac{d\psi_{0}}{d \zeta} d \zeta + c_1 \int_{-1}^{1} D \frac{d\psi_{1}}{d\zeta} \frac{d\psi_{0}}{d\zeta}d\zeta ) \right ] \label{eq:row1} \\
&J^{-1} \left  [ c_0 \int_{-1}^{1} D \frac{d\psi_{1}}{d\zeta} \frac{d\psi_{0}}{d \zeta} d \zeta + c_1 \int_{-1}^{1} D \frac{d\psi_{1}}{d\zeta} \frac{d\psi_{1}}{d\zeta}d\zeta ) \right ] \label{eq:row2} 
\end{align}
\end{subequations}

The matrix representation is as follows where $I_{nm}$ represents the individual integrals in the above equations \ref{eq:row1} and \ref{eq:row2}. 

%%%	MATRIX Int_nm%%%%%
\begin{equation}
J^{-1}
\begin{bmatrix}

Int_{00} & Int_{01} \\
Int_{10} & Int_{11}
\end{bmatrix}
\begin{bmatrix}

c_{0} \\  c_{1} 
\end{bmatrix}
\end{equation}

%%Evaluate integrals%%%%%%%%%
We now need to evaluate each $Int_{nm}$ term individually. In order to evaluate the integrals we need to calculate the derivatives of $\psi_0$ and $\psi_{1}$ with respect to $\zeta$ using the definition of the basis function given by equation \ref{eq:LagrangePSI}. The results is as follows.

\begin{subequations}
\label{eq:prematrix}
\begin{align}
\frac{d\psi_{0}}{d\zeta} &= \frac{d}{d\zeta}(\frac{1-\zeta}{2}) = -\frac{1}{2} \label{eq:psi0der}\\
\frac{d\psi_{1}}{d\zeta} &= \frac{d}{d\zeta}(\frac{1+\zeta}{2}) = \frac{1}{2} \label{eq:psi1der}
\end{align}
\end{subequations}
\\


\underline{$Int_{00}$} \\


\begin{equation}\label{eq:Int00}
\begin{split}
 Int_{00} &= \int_{-1}^{1} D \frac{d\psi_{0}}{d\zeta} \frac{d\psi_{0}}{d \zeta} d \zeta \\
&=  \int_{-1}^{1} D .( -\frac{1}{2}). (-\frac{1}{2}) d\zeta \\
& = \left[ \frac{D}{4} \zeta \right]_{-1}^{1} \\
& = \left[ (\frac{D}{4}.1) - (\frac{D}{4}.-1) \right] \\
& = \frac{D}{2}
\end{split}
\end{equation}

\underline{$Int_{01}$} \\


\begin{equation}\label{eq:Int01}
\begin{split}
 Int_{01} &= \int_{-1}^{1} D \frac{d\psi_{0}}{d\zeta} \frac{d\psi_{1}}{d \zeta} d \zeta \\
&=  \int_{-1}^{1} D .( -\frac{1}{2}). (\frac{1}{2}) d\zeta \\
& = \left[-\frac{D}{4} \zeta \right]_{-1}^{1} \\
& = \left[ (-\frac{D}{4}.1) - (-\frac{D}{4}.-1) \right] \\
& = -\frac{D}{2}
\end{split}
\end{equation}

\underline{$Int_{10}$} \\


\begin{equation}\label{eq:Int10}
\begin{split}
 Int_{01} &= \int_{-1}^{1} D \frac{d\psi_{1}}{d\zeta} \frac{d\psi_{0}}{d \zeta} d \zeta \\
&=  \int_{-1}^{1} D .( \frac{1}{2}). (-\frac{1}{2}) d\zeta \\
& = \left[-\frac{D}{4} \zeta \right]_{-1}^{1} \\
& = \left[ (-\frac{D}{4}.1) - (-\frac{D}{4}.-1) \right] \\
& = -\frac{D}{2}
\end{split}
\end{equation}


\clearpage

\underline{$Int_{11}$} \\


\begin{equation}\label{eq:Int11}
\begin{split}
 Int_{11} &= \int_{-1}^{1} D \frac{d\psi_{1}}{d\zeta} \frac{d\psi_{1}}{d \zeta} d \zeta \\
&=  \int_{-1}^{1} D .( \frac{1}{2}). (\frac{1}{2}) d\zeta \\
& = \left [\frac{D}{4} \zeta \right ]_{-1}^{1} \\
& = \left [ (\frac{D}{4}.1) - (\frac{D}{4}.-1) \right ] \\
& = \frac{D}{2}
\end{split}
\end{equation}

We can now assemble our local element matrix (not including the c term matrix). This is the form used in the code for LaplaceElemMatrix.m function. Where J and D are scalars (we have assumed D to be constant).

%%%	Final MATRIX Int_nm%%%%%
\begin{equation} \label{eq:diffmatrix}
J^{-1}D
\begin{bmatrix}

0.5 & -0.5 \\
-0.5 & 0.5
\end{bmatrix}
\end{equation}

%%%%PASSING THE UNIT TEST Q1a%%%%%%%%%%%%

\subsubsection{Passes Unit Tests}

Figure \ref{fig:passTest1} shows the function LaplaceElemMatrix.m passes the unit tests defined in CourseworkOneUnitTest.m with no errors.

%Screenshot pass unit test
\begin{figure}[h!]
	\centering
	\includegraphics[width=0.75\textwidth]{CW1Test.PNG}
	\caption{Screenshot of LaplaceElemMatrix.m Function Passing Unit Tests}\label{fig:passTest1}
\end{figure}



\subsection{Question 1b}
\subsubsection{Derivation of Reaction Element Matrix}

We need to calculate the local element matrix for the diffusion term. This is found by evaluating equation \ref{eq:reation1} term from equation XXXX(Overall equation).

\begin{equation} \label{eq:reation1}
\int_{x_{0}}^{x_{1}} \lambda c v  dx
\end{equation}

As in part a we will apply the Jacobi to map to the $\zeta$ domain. This gives us equation \ref{eq:reatJ}.

\begin{equation} \label{eq:reactJ}
\int_{-1}^1 \lambda c v J d\zeta
\end{equation}

We will again use the basis function for $c$ defined by equation \ref{eq:LagrangeC} and the Galerkin assumption to set the weighting to be the same as that of the basis function for optimal convergance as per equation \ref{eq:LagrangeV}. We can then write equation \ref{eq:reactJ} as a set of two equations similar to equations \ref{eq:row1} and \ref{eq:row2}, assuming $\lambda$ to be independent of $x$ we get the following result. These equations can also be written in the form of a matrix as shown by equation \ref{eq:reactunsolvedmatrix}.

\begin{subequations}
\label{eq:reactmatrixform}
\begin{align}
&J \lambda \left  [c_0 \int_{-1}^{1} \psi_{0} \psi_{0} d \zeta + c_1 \int_{-1}^{1} \psi_{1} \psi_{0} d\zeta ) \right ] \label{eq:reactrow1} \\
&J \lambda \left  [c_0 \int_{-1}^{1} \psi_{0} \psi_{1} d \zeta + c_1 \int_{-1}^{1} \psi_{1} \psi_{1} d\zeta ) \right ]  \label{eq:reactrow2} 
\end{align}
\end{subequations}



\begin{equation} \label{eq:reactunsolvedmatrix}
J \lambda
\begin{bmatrix}

Int_{00} & Int_{01} \\
Int_{10} & Int_{11}
\end{bmatrix}
\begin{bmatrix}

c_{0} \\  c_{1} 
\end{bmatrix}
\end{equation}
\\
We shall now evaluate the $Int_{nm}$ integrals to derive the matrix.

\underline{$Int_{00}$} \\
\begin{equation}\label{eq:Int00}
\begin{split}
 Int_{00} &= \int_{-1}^{1} \psi_{0}\psi_{0} \ d \zeta \\
&=  \int_{-1}^{1}  \Big ( \frac{1-\zeta}{2} \Big )^2 d\zeta \\
& = \left[ \frac{1}{3} \Big ( \frac{1-\zeta}{2} \Big )^3 (-2) \right]_{-1}^{1} \\
& = \frac{2}{3}
\end{split}
\end{equation}

\underline{$Int_{01} = Int_{10}$} \\

\begin{equation}\label{eq:Int01}
\begin{split}
 Int_{00} &= \int_{-1}^{1} \psi_{0}\psi_{1} \ d \zeta \\
&=  \int_{-1}^{1}  \Big ( \frac{1-\zeta}{2} \Big )  \Big ( \frac{1+\zeta}{2} \Big )d\zeta \\
& = \left[ \frac{\zeta}{4} - \frac{\zeta^3}{12}\right]_{-1}^{1} \\
& = \left[ \frac{1}{6} -  \Big (-\frac{1}{4} + \frac{1}{12} \Big )\right]_{-1}^{1} \\
& = \frac{1}{3}
\end{split}
\end{equation}

\underline{$Int_{11}$} \\
\begin{equation}\label{eq:Int00}
\begin{split}
 Int_{00} &= \int_{-1}^{1} \psi_{1}\psi_{1} \ d \zeta \\
&=  \int_{-1}^{1}  \Big ( \frac{1+\zeta}{2} \Big )^2 d\zeta \\
& = \left[ \frac{1}{3} \Big ( \frac{1+\zeta}{2}\Big)^3 . 2 \right]_{-1}^{1} \\
& = \frac{2}{3}
\end{split}
\end{equation}

Putting the results of the integrals into the matrix for from equation \ref{eq:reactunsolvedmatrix} we get the result shown by equation \ref{eq:reactmatrix}. This result is used by the LinearReactionElemMatrix.m function. As per equation XXXX we will need to subtract this result from the local diffusion element matrix result given by equation \ref{eq:diffmatrix} in order to get the overall local element matrix which we can then assemble into an global matrix.

%%%	Reaction Matrix%%%%%
\begin{equation} \label{eq:reactmatrix}
J\lambda
\begin{bmatrix}

\frac{2}{3} & \frac{1}{3}  \\[1ex]
 \frac{1}{3}  & \frac{2}{3}
\end{bmatrix}
\end{equation}


%%%UNIT TEST FOR 1BBBBBB \\\\\\\\\\\\\\\\\\\\\\\\\\\%%%%%%%%%%%%
\subsubsection{Linear Reaction Element Matrix Unit Test}

A test script with four unit tests was made to check that the Linear Reaction Element Matrix function was working correctly. The tests were as follows\\
\begin{enumerate}
\item{Check outputted matrix is symmetrical}
\item{Two outputs for two elements in an equispaced mesh are the same }
\item{Check against known solution from (from tutorial 3 q2c solution).}
\item{Element 11 is double the value of element 21 for random mesh size and $\lambda$}
\end{enumerate}

It is important to test the matrix has all the properties of the matrix derived in equation \ref{eq:reactmatrix}. This includes symmetry, and the lead diagonal symmetric pair being double the anti-diagonal symmetric pair. We also need to check the values are correct as well as the form so the function has been tested against a known result. The function will be also be tested to assert two different elements of an equispaced mesh are identical which confirms the function works over the entire domain and not just the first element. Test 4 has also been conducted for a random mesh size and a random value of $\lambda$ for added assurance. \\
The function NAMEOFFUNCTIONHERE XXX passes the unit tests as shown by Figure \ref{fig:passTest2}

%Screenshot pass unit test 2222
\begin{figure}[h!]
	\centering
	\includegraphics[width=0.9\textwidth]{LRtest2.PNG}
	\caption{Screenshot of LinearReationElemMatrix.m Function Passing Unit Tests}\label{fig:passTest2}
\end{figure}

\subsubsection{Solving Laplace With Dirichlet Boundaries}

We will use the finite element solver to solve Laplace's equation: 

\begin{equation}
\label{eq:Laplace}
\frac{\partial^2 c}{\partial x^2} = 0
\end{equation}

over the domain $x = 0$ to $x = 1$ with the Dirichlet boundary conditions:

\begin{subequations}\label{eq:LaplaceBCs}
\begin{align}
c = 2 \ \ at \ \ x = 0 \\
c = 0 \ \ at \ \ x  = 1
\end{align}
\end{subequations}

The analytical solution is given by equation \ref{eq:LaplaceAnalytical}.

\begin{equation}\label{eq:LaplaceAnalytical}
c = 2(1-x)
\end{equation}

The result of the analytical solution has been plotted in \ref{fig:LaplaceFig1} with the FEM results overlaid. The FEM solution is very accurate here because we have used linear approximations as our basis functions and the analytical solution is also linear. This means we can achieve good results even with a low resolution 4 element mesh.

\begin{figure}[h!] 
    \centering
    \includegraphics{epsLaplaceFig1}
    \caption{Comparison of Analytical and Finite Element Solutions of Laplace's Equation}\label{fig:LaplaceFig1}
\end{figure}

\subsubsection{Add a Neumann Boundary}
Now we will change the initial boundary condition to a Neumann boundary, the conditions are given by equations \ref{eq:LaplaceBCs2}.

\begin{subequations}\label{eq:LaplaceBCs2}
\begin{align}
\frac{dc}{dx} = 2 \ \ at \ \ x = 0 \\
c = 0 \ \ at \ \  x= 1
\end{align}
\end{subequations}

\begin{figure}[h!] 
    \centering
    \includegraphics{epsLaplaceFig2}
    \caption{Using the FEM to solve Laplace's Equation with an initial Neumann Boundary}\label{fig:LaplaceFig2}
\end{figure}

The solution found using the FEM method with a 4 element mesh is plotted in Figure \ref{fig:LaplaceFig2}. The solution is still linear which is expected but the effect of change the initial boundary condition from $c = 2$ to $\frac{\partial c}{\partial x} = 2$ has meant c$c = -2$ at $x = 0$. This is to be expected as the function is linear and therefore has a constant gradient over the domain which is defined by the Neumann condition. As the Dirichlet Boundary is fixed at $c = 0$ at $x = 1$ in order to achieve the gradient $\frac{\partial c}{\partial x} = 2$ then we must have $c = -2$ at $x = 0$. The same result could be achieved with a Dirichlet boundary of $c = -2$ at $x = 0$.

\subsection{Question 1d}

We will now test that the FEM solver deals with reaction terms correctly by solving the diffusion-reaction equation:

\begin{equation*}
D \frac{\partial^2 c}{\partial x^2} + \lambda c = 0
\end{equation*}

with the following parameters:

\begin{equation*}
D = 1, \ \  \lambda = -9
\end{equation*}

and the Dirichlet boundary conditions:


\begin{align*}
c = 0 \ \ at \ \ x = 0 \\
c = 1 \ \ at \ \  x= 1  .
\end{align*}


The analytical solution is given by equation \ref{eq:diffreactanalytical}. This has been plotted on Figure \ref{fig:ChangeMesh} along with the Finite Element Method solution for a range of mesh sizes. It can be seen how the FEM converges on the analytical solution as the mesh size is increased. For a mesh size of 3 elements there is a clear deviation from the analytical solution. This divergence is clearer towards $x = 1$ where the gradient of the analytical solution changes the most and the linear assumption is least valid. However once the a mesh size is increased to 10 elements the plot is difficult to distinguish from the analytical solution and by 25 elements the error is less than 1\%.

\begin{equation}\label{eq:diffreactanalytical}
c(x) = \frac{e^3 }{e^6 - 1} (3e^{3x} - 3e^{-3x})
\end{equation}

\begin{figure}[ht] 

    \centering
    \includegraphics{epsReactDiff1}
    \caption{Using the FEM to solve Diffusion-Reaction Equation with Dirichlet Boundary Conditions}\label{fig:ChangeMesh}
\end{figure}

\clearpage

\section{Part 2}

For part 2 we will use the FEM method to find the temperature profile through a material filled with small diameter heating channels. The cross section of the material is shown in Figure \ref{fig:CrossSection} and approximates to a 1D heat transfer problem given by equation \ref{eq:part2analytical1}.

\begin{figure}[h!] 
    \centering
    \includegraphics{CrossSection}
    \caption{Cross Section of Material.}\label{fig:CrossSection}
\end{figure}

\begin{equation} \label{eq:part2analytical1}
k \frac{\partial^2 T}{\partial x^2} + Q(T_L - T) = 0
\end{equation}

We can rewrite this equation into the general diffusion-reaction equation form given by equation \ref{eq:DRgeneral} which gives us equation \ref{eq:inDRgeneralform}.

\begin{subequations}
\begin{align}
D \frac{\partial^2c}{\partial x^2} + \lambda c + f = 0 \label{eq:DRgeneral} \\
D \frac{\partial^2T}{\partial x^2} + (-Q) T + QT_L = 0 \label{eq:inDRgeneralform}
\end{align}
\end{subequations}

We want to solve for a range of liquid flow rates, $Q$, and liquid temperatures, $T_L$ given below with the equivalent FEM input values given in brackets.

\begin{align*}
&Q = 0.5 \ \text{to} \ 1.5 \ \ \ \ (\lambda = -0.5 \ \text{to} \ -1.5) \\
&T_L = 294.15K \ \text{to}\ 322.15K \ \ (f =  294.15Q \ \text{to} \ 322.15Q )
\end{align*}

The equation was solved for a range of values of Q and the results plotted. This was repeated for 4 values of $T_L$ to and the result is shown in Figure \ref{fig:varyQmulti}. \\
\clearpage


\begin{figure*}[ht] 
        \centering
        \begin{subfigure}[b]{0.475\textwidth}
            \centering
            \includegraphics[width=\textwidth]{epsVaryQ294}
            \caption[Network2]%
            {{\small  1}}    
            \label{fig:varyQ14}
        \end{subfigure}
        \hfill
        \begin{subfigure}[b]{0.475\textwidth}  
            \centering 
            \includegraphics[width=\textwidth]{epsVaryQ301}
            \caption[]%
            {{\small }}    
            \label{fig:varyQ24}
        \end{subfigure}
        \vskip\baselineskip
        \begin{subfigure}[b]{0.475\textwidth}   
            \centering 
            \includegraphics[width=\textwidth]{epsVaryQ308}
            \caption[]%
            {{\small }}    
            \label{fig:varyQ34}
        \end{subfigure}
        \quad
        \begin{subfigure}[b]{0.475\textwidth}   
            \centering 
            \includegraphics[width=\textwidth]{epsVaryQ322}
            \caption[]%
            {{\small }}    
            \label{fig:varyQ44}
        \end{subfigure}
        \caption[ The Effect of Varying the Liquid Flow Rate on Temperature Distribution and Gradient]
        {\small The Effect of Varying the Liquid Flow Rate on Temperature Distribution and Gradient} 
        \label{fig:varyQmulti}
    \end{figure*}

The effect of increasing the liquid flow rate is to bring the temperature profile towards the liquid temperature. This is most evident when their is a large differential temperature between the liquid and a boundary condition as a large temperature differential means a lot of heat can be transferred. For example in Figure \ref{fig:varyQ14} the liquid temperature is much cooler than the left hand boundary and so is heated by the material. As the thermal energy is transferred to the liquid its temperature rises reducing the differential temperature which reduces the rate of heat transfer. With higher flow rates the liquid temperature does not rise as much and so there is more heat transfer and steeper temperature gradient at and near the LHS boundary compared to the lower flows. 


\clearpage

\begin{figure*}[ht] 
        \centering
        \begin{subfigure}[b]{0.475\textwidth}
            \centering
            \includegraphics[width=\textwidth]{epsVaryTL1}
            \caption[Network2]%
            {{\small  }}    
            \label{fig:varyQ14}
        \end{subfigure}
        \hfill
        \begin{subfigure}[b]{0.475\textwidth}  
            \centering 
            \includegraphics[width=\textwidth]{epsVaryTL2}
            \caption[]%
            {{\small }}    
            \label{fig:varyQ24}
        \end{subfigure}
        \vskip\baselineskip
        \begin{subfigure}[b]{0.475\textwidth}   
            \centering 
            \includegraphics[width=\textwidth]{epsVaryTL4}
            \caption[]%
            {{\small }}    
            \label{fig:varyQ34}
        \end{subfigure}
        \quad
        \begin{subfigure}[b]{0.475\textwidth}   
            \centering 
            \includegraphics[width=\textwidth]{epsVaryTL5}
            \caption[]%
            {{\small }}    
            \label{fig:varyQ44}
        \end{subfigure}
        \caption[ The Effect of Varying the Liquid Temperature on Temperature Distribution and Gradient ]
        {\small The Effect of Varying the Liquid Temperature on Temperature Distribution and Gradient} 
        \label{fig:tempvar}
    \end{figure*}

Figure \ref{fig:tempvar} show how the liquid temperature determines the curvature of the temperature profile. When the liquid temperature is at 308.15k the temperature profile is relatively linear as this temperature is the mid-point between the two boundary conditions. When the liquid temperature increases the profile becomes more parabolic and convex. Similarly as the temperature decreases the profile becomes more parabolic and concave. Again this effect is more pronounced with higher liquid flows rates.

\clearpage

\subsubsection{Effect of Mesh Size}

To runt he solver efficiently we need the minimum mesh size which provides sufficient resolution. To find the appropriate mesh size the least linear solution needs to be used which is that with the highest liquid flow rate $Q = 1.5$ and minimum liquid temperature $T_L = 294.15$. The solution for several mesh sizes is shown in Figure \ref{fig:fullviewmesh}. 

\begin{figure}[h!]
    \centering
    \includegraphics{epsMesh01}
    \caption{Cross Section of Material }\label{fig:fullviewmesh}
\end{figure}
\clearpage
\begin{figure*}[ht] 
        \centering
        \begin{subfigure}[b]{0.475\textwidth}
            \centering
            \includegraphics[width=\textwidth]{epsMesh11}
            \caption[Network2]%
            {{\small  }}    
            \label{fig:zoommesh1}
        \end{subfigure}
        \hfill
        \begin{subfigure}[b]{0.475\textwidth}  
            \centering 
            \includegraphics[width=\textwidth]{epsMesh12}
            \caption[]%
            {{\small }}    
            \label{fig:zoommesh2}
        \end{subfigure}
        \caption[ The Effect of Mesh Size on Temperature Resolution ]
        {\small The Effect of Mesh Size on Temperature Resolution} 
        \label{fig:meshzoom}
    \end{figure*}

An acceptable resolution for temperature is .01K only very specialised and expensive temperature sensors have greater accuracy than this. In Figure \ref{fig:zoommesh1} it appears as though the 35, 50 and 70 element meshes have all converged to well within 0.01k. Figure \ref{fig:zoommesh2}, which is at the same temperature scale as Figure \ref{fig:zoommesh1}, shows that this convergence does not hold over the entire domain. The 35 element mesh is now approximately .02k above the 70 element mesh however the 50 and 70 element meshes are still within .01K. Figure \ref{fig:zoommesh2} is at one of the points in Figure \ref{fig:fullviewmesh} with the greatest divergence in solutions and so it can be said that a 50 element mesh is provides the required resolution.

\clearpage

\subsection{Question 2b}

\subsubsection{Derivation of Linear Source Term}

The temperature of the liquid is changed to be a function of $x$  resulting in a new governing equation described by equation \ref{eq:2bmain}.

\begin{equation} \label{eq:2bmain}
k \frac{\partial^2 T}{\partial x^2} + Q(T_L(1 + 4x) - T) = 0
\end{equation}



The equation can be rearranged to the standard form as given by equation \ref{eq:DRgeneral} which gives us equation \ref{eq:2bDRform}.
\begin{equation} \label{eq:2bDFform}
k \frac{\partial^2 T}{\partial x^2} + (-Q)T + \left [ QT_L + 4QT_Lx \right ] = 0
\end{equation}

This is the same as equation \ref{eq:inDRgeneralform} but with an extra source term $4QT_Lx$. Therefore the extra source integration we to solve the following integral where the Galerkin formulation has been applied.

\begin{equation*}
\int_{0}^{1}v4QT_Lx dx
\end{equation*}


Again this integral can be split into a summation of  again split this integration into a sum of elements as shown below for four elements.

\begin{equation*}
\int_0^1 4QT_Lx dx = \int_0^\frac{1}{4} 4QT_Lx dx + \int_\frac{1}{4}^\frac{2}{4}4QT_Lx  dx + \int_\frac{2}{4}^\frac{3}{4}  4QT_Lx dx + \int_\frac{3}{4}^1 4QT_Lx dx
\end{equation*}



Applying the Jacobi to map to the $\zeta$ domain and taking constants out of the integral gives the following.

\begin{equation} \label{eq:LinSJ}
\int_{x_0}^{x_1} = 4QT_L\int_{-1}^1 vxJ d\zeta
\end{equation}

To solve this extra term it is necessary to use the basis function for $x$ given by equation \ref{eq:LagrangeX} and shown below as well as the basis function for $v$.

\begin{align*}
&x = x_{0}\psi_{0}(\zeta) + x_1\psi_{1}(\zeta) \\
&v = \psi_{0}, \psi_{1}
\end{align*}

As before this gives a set of two integrals which can be written in matrix form as shown below.


\begin{subequations}
\label{eq:linSsim}
\begin{align}
&4QT_LJ \left  [x_0 \int_{-1}^{1} \psi_{0} \psi_{0} d \zeta + x_1 \int_{-1}^{1} \psi_{1} \psi_{0} d\zeta ) \right ] \label{eq:linsrow1} \\
&4QT_LJ  \left  [x_0 \int_{-1}^{1} \psi_{0} \psi_{1} d \zeta + x_1 \int_{-1}^{1} \psi_{1} \psi_{1} d\zeta ) \right ]  \label{eq:linsrow2} 
\end{align}
\end{subequations}



\begin{equation} \label{eq:linSmatrix}
4QT_LJ 
\begin{bmatrix}

Int_{00} & Int_{01} \\
Int_{10} & Int_{11}
\end{bmatrix}
\begin{bmatrix}

x_{0} \\  x_{1} 
\end{bmatrix}
\end{equation}


We shall now evaluate the $Int_{nm}$ integrals to derive the matrix. It can be noted that these are the same $Int_{nm}$ terms that were solved to derive the reaction element matrix and so the same result should be found.

\underline{$Int_{00}$} \\
\begin{equation}\label{eq:LSInt00}
\begin{split}
 Int_{00} &= \int_{-1}^{1} \psi_{0}\psi_{0} \ d \zeta \\
&=  \int_{-1}^{1}  \Big ( \frac{1-\zeta}{2} \Big )^2 d\zeta \\
& = \left[ \frac{1}{3} \Big ( \frac{1-\zeta}{2} \Big )^3 (-2) \right]_{-1}^{1} \\
& = \frac{2}{3}
\end{split}
\end{equation}

\underline{$Int_{01} = Int_{10}$} \\

\begin{equation}\label{eq:LSInt01}
\begin{split}
 Int_{00} &= \int_{-1}^{1} \psi_{0}\psi_{1} \ d \zeta \\
&=  \int_{-1}^{1}  \Big ( \frac{1-\zeta}{2} \Big )  \Big ( \frac{1+\zeta}{2} \Big )d\zeta \\
& = \left[ \frac{\zeta}{4} - \frac{\zeta^3}{12}\right]_{-1}^{1} \\
& = \left[ \frac{1}{6} -  \Big (-\frac{1}{4} + \frac{1}{12} \Big )\right]_{-1}^{1} \\
& = \frac{1}{3}
\end{split}
\end{equation}

\underline{$Int_{11}$} \\
\begin{equation}\label{eq:LSInt00}
\begin{split}
 Int_{00} &= \int_{-1}^{1} \psi_{1}\psi_{1} \ d \zeta \\
&=  \int_{-1}^{1}  \Big ( \frac{1+\zeta}{2} \Big )^2 d\zeta \\
& = \left[ \frac{1}{3} \Big ( \frac{1+\zeta}{2}\Big)^3 . 2 \right]_{-1}^{1} \\
& = \frac{2}{3}
\end{split}
\end{equation}



Now putting substituting these results into the matrix form to get the following solution for the local element vector linear source terms, $f_L$ at the local element nodes 0 and 1. These local linear source nodes can be added to the local 'scalar' source nodes created for the $QT_L$ term, thus deriving the global source matrix needed for the FEM solver.


%%%LINEAR SOURCE MATRIX%%%%%%%
\begin{equation} \label{eq:linSresult}
\begin{bmatrix}
f_{L_0}\\[1ex]
 f_{L_1} 
\end{bmatrix}
= 4QT_L J 
\begin{bmatrix}
\frac{2}{3} & \frac{1}{3}  \\[1ex]
 \frac{1}{3}  & \frac{2}{3}
\end{bmatrix}
\begin{bmatrix}
x_{0} \\[1ex] x_{1} 
\end{bmatrix}
\end{equation}
\clearpage


\subsubsection{Linear Source Results}

\begin{figure*}[ht] 
        \centering
        \begin{subfigure}[b]{0.475\textwidth}
            \centering
            \includegraphics[width=\textwidth]{epsLinear294}
            \caption[Network2]%
            {{\small  }}    
            \label{fig:Linear294}
        \end{subfigure}
        \hfill
        \begin{subfigure}[b]{0.475\textwidth}  
            \centering 
            \includegraphics[width=\textwidth]{epsLinear301}
            \caption[]%
            {{\small }}    
            \label{fig:Linear301}
        \end{subfigure}
        \vskip\baselineskip
        \begin{subfigure}[b]{0.475\textwidth}   
            \centering 
            \includegraphics[width=\textwidth]{epsLinear308}
            \caption[]%
            {{\small }}    
            \label{fig:Linear308}
        \end{subfigure}
        \quad
        \begin{subfigure}[b]{0.475\textwidth}   
            \centering 
            \includegraphics[width=\textwidth]{epsLinear322}
            \caption[]%
            {{\small }}    
            \label{fig:Linear322}
        \end{subfigure}
        \caption[ The Effect of Varying the Liquid Temperature on Temperature Distribution and Gradient ]
        {\small The Effect of Varying the Liquid Temperature on Temperature Distribution and Gradient ($Q =1$)} 
        \label{fig:LinearF}
    \end{figure*}

Figure \ref{fig:LinearF} shows how the linear source term, which represents the liquid temperature rising as $x$ increases, raises the temperature profile at the right hand boundary compared to the constant liquid temperature case.

%\begin{thebibliography}{9}
%%Last name, First Initial, Year published. Title. Publisher, Volume, Page(s).
%% HARVARD REFERENCE STYLE:
%%Brunner, F.H., 1949. Synthetic gasoline from natural gas. Industrial and engineering chemistry, 41(11), pp.2511-2515.
%
%\bibitem{SPEC} 
%Macgregor, K., 2017. 
%\textit{Student Design Project Specification 2017/18.}
%Airbus Group.


%\end{thebibliography}

\pagebreak

\begin{appendices}
%%AAAAAAAAAAAAAAAAAAAAAAAAAA%%%%%%%
\section{Laplace Element Matrix Code}
\begin{lstlisting}
function [SqMatrix] = LaplaceElemMatrix(D, eID, msh)

%Returns a local 2x2 element matrix of a given element for a diffusion
%operator
% Inputs: 
% D - Coefficient of Diffusion
% eID - Index of element within mesh structure
% msh - Mesh which contains local elements within it's structure

%% Local element matrix for J = 1
SqMatrix = zeros(2,2);
SqMatrix(1,1) = 0.5*D;
SqMatrix(1,2) = -0.5*D;
SqMatrix(2,1) = -0.5*D;
SqMatrix(2,2) = 0.5*D;

%% To get local element matrix for this element multiply by dZeta/dx which
%is equivalent to 1/J 

J = msh.elem(eID).J;  %Get Jacobian for the element
SqMatrix = (1/J) .* SqMatrix;   %Local element matrix for element eID

end
\end{lstlisting}
\pagebreak
%%%%%%%%BBBBBBBBBBBBBBBBBBBBBB%%%%%%%%%%%%%%%%%
\section{Linear Reaction Element Matrix Code} \label{ap:ReactCode}
\begin{lstlisting}
\end{lstlisting}
\pagebreak
%%%%%%%%CCCCCCCCCCCCCCCCCCCC%%%%%%%%%%%%%%%%%
\section{Linear Reaction Element Matrix Test} \label{ap:ReactTest}
\begin{lstlisting}
\end{lstlisting}
\pagebreak
%%%%%%%%DDDDDDDDDDDDDDD%%%%%%%%%%%%%
\section{Apply Boundary Condition Code} \label{ap:BC}
\begin{lstlisting}
\end{lstlisting}
\pagebreak






\end{appendices}





\end{document}

